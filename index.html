<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Release Timeline</title>
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8fafc;
            color: #334155;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .timeline-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
        }
        
        .timeline-header {
            background-color: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .month-header {
            height: 30px;
            position: relative;
            background-color: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .month-marker {
            position: absolute;
            font-size: 11px;
            font-weight: 500;
            color: #64748b;
            text-align: center;
            padding-top: 5px;
            border-left: 1px solid #e2e8f0;
            height: 100%;
        }
        
        .product-row {
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.15s;
        }
        
        .product-row:hover {
            background-color: #f8fafc;
        }
        
        .product-cell {
            padding: 12px 16px;
            width: 220px;
            background-color: #fff;
            position: sticky;
            left: 0;
            z-index: 10;
            border-right: 1px solid #e2e8f0;
        }
        
        .product-name {
            white-space: nowrap;
        }
        
        .product-info {
            flex: 1;
            min-width: 0;
            margin-right: 16px;
        }
        
        .risk-container {
            display: flex;
            align-items: center;
            min-width: 100px;
            justify-content: flex-end;
            flex-shrink: 0;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .timeline-cell {
            position: relative;
            height: 60px;
        }
        
        .timeline-bar {
            position: absolute;
            height: 12px;
            top: 24px;
            border-radius: 6px;
        }
        
        .stage-date {
            position: absolute;
            font-size: 11px;
            color: #64748b;
            top: 40px;
            transform: translateX(-50%);
            white-space: nowrap;
            background-color: white;
            padding: 0 2px;
            border-radius: 2px;
            z-index: 2;
        }
        
        .stage-date.top-position {
            top: 10px;
        }
        
        .stage-date.edge-right {
            transform: translateX(-100%);
            left: auto !important;
            right: 0;
        }
        
        .release-date {
            position: absolute;
            font-size: 11px;
            color: #16a34a;
            font-weight: 600;
            line-height: 12px;
            top: 24px;
            white-space: nowrap;
            background-color: #dcfce7;
            padding: 0 4px;
            margin-left: 5px;
            border-radius: 3px;
            border: 1px solid #22c55e;
            z-index: 4;
        }
        
        .status-high {
            background-color: #fee2e2;
            color: #ef4444;
        }
        
        .status-medium {
            background-color: #fef3c7;
            color: #f59e0b;
        }
        
        .status-low {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        
        .key-features {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s, padding 0.3s;
            padding: 0 16px;
            background-color: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }
        
        .key-features.active {
            max-height: 300px;
            padding: 16px;
        }
        
        .features-row {
            background-color: #f8fafc;
        }
        
        .key-features-cell {
            padding: 0;
        }
        
        .features-row .key-features {
            padding: 16px;
            max-height: none;
            height: auto;
        }
        
        .features-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .features-list li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
        }
        
        .features-list li i {
            color: #10b981;
            margin-right: 8px;
            margin-top: 4px;
            font-size: 14px;
        }
        
        .timeline-segment-requirements {
            background-color: #8b5cf6;
        }
        
        .timeline-segment-development {
            background-color: #3b82f6;
        }
        
        .timeline-segment-dten-qa {
            background-color: #f97316;
        }
        
        .timeline-segment-ms-qa {
            background-color: #eab308;
        }
        
        .timeline-segment-release {
            background-color: #22c55e;
        }
        
        .legend {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 20px;
            padding: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #64748b;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 6px;
        }
        
        @media (max-width: 768px) {
            .product-cell {
                width: 150px;
            }
            
            .container {
                padding: 0.5rem;
            }
        }
        
        table {
            table-layout: fixed;
            width: 100%;
            border-collapse: collapse;
        }
        
        .timeline-content {
            overflow-x: auto;
            width: 100%;
        }
        
        .timeline-wrapper {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="mb-4">
            <h1 class="text-2xl font-bold text-gray-800 mb-1">Product Release Timeline</h1>
            <p class="text-gray-600">Real-time visualization of product development stages and release dates</p>
        </header>
        
        <div class="timeline-container">
            <div class="timeline-content">
                <div class="timeline-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th class="product-cell">Product</th>
                                <th>
                                    <div id="month-header" class="month-header">
                                        <!-- Month markers will be dynamically added via JavaScript -->
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="products-container">
                            <!-- Product rows will be dynamically added -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 图例放在底部 -->
        <div class="legend bg-white p-3 rounded mt-4 shadow-sm">
            <div class="legend-item">
                <div class="legend-color bg-purple-500"></div>
                <span>Requirements</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-blue-500"></div>
                <span>Development</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-orange-500"></div>
                <span>DTEN QA Testing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-yellow-500"></div>
                <span>Microsoft QA Testing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-green-500"></div>
                <span>Release</span>
            </div>
        </div>
    </div>
    
    <script>
        // 硬编码的产品数据，不需要从API获取
        const products = [
            {
                "id": "dten-bar",
                "name": "DTEN Bar",
                "version": "1.4.30",
                "riskLevel": "low risk",
                "keyFeatures": [
                    "Vue and Vue Pro people tracking algorithm",
                    "BYOD selection screen under Teams"
                ],
                "delayFactors": [],
                "stages": [
                    {
                        "name": "requirements",
                        "startDate": "2024-07-15",
                        "endDate": "2024-07-26"
                    },
                    {
                        "name": "development",
                        "startDate": "2024-07-15",
                        "endDate": "2024-09-05"
                    },
                    {
                        "name": "dten-qa",
                        "startDate": "2024-09-06",
                        "endDate": "2025-02-24"
                    },
                    {
                        "name": "ms-qa",
                        "startDate": "2025-03-17",
                        "endDate": "2025-04-14"
                    },
                    {
                        "name": "release",
                        "startDate": "2025-04-15",
                        "endDate": "2025-04-15"
                    }
                ]
            },
            {
                "id": "d7x-a",
                "name": "D7X-A",
                "version": "1.7.0",
                "riskLevel": "low risk",
                "keyFeatures": [
                    "Vue and Vue Pro people tracking algorithm",
                    "BYOD selection screen under Teams"
                ],
                "delayFactors": [],
                "stages": [
                    {
                        "name": "requirements",
                        "startDate": "2024-07-15",
                        "endDate": "2024-07-26"
                    },
                    {
                        "name": "development",
                        "startDate": "2024-07-15",
                        "endDate": "2024-09-05"
                    },
                    {
                        "name": "dten-qa",
                        "startDate": "2024-09-06",
                        "endDate": "2025-03-14"
                    },
                    {
                        "name": "ms-qa",
                        "startDate": "2025-03-17",
                        "endDate": "2025-04-14"
                    },
                    {
                        "name": "release",
                        "startDate": "2025-04-15",
                        "endDate": "2025-04-15"
                    }
                ]
            },
            {
                "id": "dten-mate",
                "name": "DTEN Mate",
                "version": "2.4.0",
                "riskLevel": "low risk",
                "keyFeatures": [
                    "Vue and Vue Pro people tracking algorithm",
                    "BYOD selection screen under Teams"
                ],
                "delayFactors": [],
                "stages": [
                    {
                        "name": "requirements",
                        "startDate": "2024-07-15",
                        "endDate": "2024-07-26"
                    },
                    {
                        "name": "development",
                        "startDate": "2024-07-15",
                        "endDate": "2024-09-05"
                    },
                    {
                        "name": "dten-qa",
                        "startDate": "2024-09-06",
                        "endDate": "2025-03-14"
                    },
                    {
                        "name": "ms-qa",
                        "startDate": "2025-03-17",
                        "endDate": "2025-04-14"
                    },
                    {
                        "name": "release",
                        "startDate": "2025-04-15",
                        "endDate": "2025-04-15"
                    }
                ]
            },
            {
                "id": "d7x-w",
                "name": "D7X-W",
                "version": "3.9.2",
                "riskLevel": "released",
                "keyFeatures": ["video boundary for main camera"],
                "delayFactors": [],
                "stages": [
                    {
                        "name": "requirements",
                        "startDate": "2025-01-10",
                        "endDate": "2025-01-10"
                    },
                    {
                        "name": "development",
                        "startDate": "2025-01-10",
                        "endDate": "2025-03-11"
                    },
                    {
                        "name": "dten-qa",
                        "startDate": "2025-03-11",
                        "endDate": "2025-03-26"
                    },
                    {
                        "name": "release",
                        "startDate": "2025-03-26",
                        "endDate": "2025-03-26"
                    }
                ]
            }
        ];

        // 渲染产品时间线
        function renderProductTimeline() {
            try {
                // 计算所有产品的最早和最晚日期，只显示有产品的月份
                let earliestDate = new Date('2099-12-31');
                let latestDate = new Date('2000-01-01');
                
                products.forEach(product => {
                    product.stages.forEach(stage => {
                        if (stage.startDate) {
                            const startDate = new Date(stage.startDate);
                            if (startDate < earliestDate) {
                                earliestDate = startDate;
                            }
                        }
                        if (stage.endDate) {
                            const endDate = new Date(stage.endDate);
                            if (endDate > latestDate) {
                                latestDate = endDate;
                            }
                        }
                    });
                });
                
                // 将最早日期向前调整一个月，最晚日期向后调整一个月，确保有足够的显示空间
                earliestDate.setMonth(earliestDate.getMonth() - 1);
                latestDate.setMonth(latestDate.getMonth() + 1);
                
                // 时间线配置
                const CONFIG = {
                    timelineStart: earliestDate,
                    timelineEnd: latestDate,
                    monthWidth: 80 // 增加每个月的宽度，减少重叠
                };
                
                // 计算总宽度
                function calculateTimelineWidth() {
                    const months = monthDiff(CONFIG.timelineStart, CONFIG.timelineEnd);
                    return months * CONFIG.monthWidth;
                }
                
                // 计算两个日期之间的月数
                function monthDiff(startDate, endDate) {
                    return (
                        (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                        endDate.getMonth() - startDate.getMonth() + 1 // 包括开始和结束月
                    );
                }
                
                // 计算日期在时间线上的位置
                function calculateDatePosition(date) {
                    const targetDate = new Date(date);
                    const totalDays = (CONFIG.timelineEnd - CONFIG.timelineStart) / (1000 * 60 * 60 * 24);
                    const passedDays = (targetDate - CONFIG.timelineStart) / (1000 * 60 * 60 * 24);
                    
                    const timelineWidth = calculateTimelineWidth();
                    return (passedDays / totalDays) * timelineWidth;
                }
                
                // 格式化日期显示 (MM/DD 格式，不显示年份)
                function formatDateDisplay(dateString) {
                    const date = new Date(dateString);
                    const month = String(date.getMonth() + 1);
                    const day = String(date.getDate());
                    return `${month}/${day}`;
                }
                
                const container = document.getElementById('products-container');
                const timelineWidth = calculateTimelineWidth();
                
                // 创建月份标记
                function createMonthScale() {
                    const monthHeader = document.getElementById('month-header');
                    monthHeader.innerHTML = ''; // 清空现有内容
                    
                    // 设置整个月份容器的宽度
                    const timelineCell = document.querySelector('th:nth-child(2)');
                    timelineCell.style.width = `${timelineWidth}px`;
                    monthHeader.style.width = `${timelineWidth}px`;
                    
                    let currentDate = new Date(CONFIG.timelineStart);
                    let monthIndex = 0;
                    
                    // 创建所有月份标记
                    while (currentDate <= CONFIG.timelineEnd) {
                        const position = monthIndex * CONFIG.monthWidth;
                        const monthMarker = document.createElement('div');
                        monthMarker.className = 'month-marker';
                        
                        const month = currentDate.toLocaleString('default', { month: 'short' });
                        monthMarker.textContent = month; // 只显示月份，不显示年份
                        monthMarker.style.left = `${position}px`;
                        monthMarker.style.width = `${CONFIG.monthWidth}px`;
                        
                        monthHeader.appendChild(monthMarker);
                        
                        // 移动到下个月
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        monthIndex++;
                    }
                }
                
                // 获取风险级别的CSS类
                function getRiskStatusClass(riskLevel) {
                    switch(riskLevel.toLowerCase()) {
                        case 'high':
                            return 'status-high';
                        case 'medium':
                            return 'status-medium';
                        default:
                            return 'status-low';
                    }
                }
                
                products.forEach(product => {
                    // 创建产品行
                    const row = document.createElement('tr');
                    row.className = 'product-row';
                    row.dataset.productId = product.id;
                    
                    // 产品信息单元格
                    const productCell = document.createElement('td');
                    productCell.className = 'product-cell';
                    productCell.innerHTML = `
                        <div class="flex items-center justify-between cursor-pointer" onclick="toggleFeatures('${product.id}')">
                            <div class="product-info">
                                <div class="font-medium product-name">${product.name}</div>
                                <div class="text-sm text-gray-500">v${product.version}</div>
                            </div>
                            <div class="risk-container">
                                <span class="status-badge ${getRiskStatusClass(product.riskLevel)}">${product.riskLevel}</span>
                                <i id="icon-${product.id}" class="fas fa-chevron-right ml-2 text-gray-400 text-sm"></i>
                            </div>
                        </div>
                    `;
                    
                    // 时间线单元格
                    const timelineCell = document.createElement('td');
                    timelineCell.className = 'timeline-cell';
                    
                    // 创建时间线区域，确保足够宽度
                    const timelineArea = document.createElement('div');
                    timelineArea.className = 'relative';
                    timelineArea.style.width = `${timelineWidth}px`;
                    timelineArea.style.height = '100%';
                    timelineCell.appendChild(timelineArea);
                    
                    // 找到每个产品的ms-qa阶段和release阶段
                    let msQaStage = null;
                    let releaseStage = null;
                    
                    product.stages.forEach(stage => {
                        if (stage.name === 'ms-qa') {
                            msQaStage = stage;
                        } else if (stage.name === 'release') {
                            releaseStage = stage;
                        }
                    });
                    
                    // 添加每个阶段的时间线段
                    let addedDatesMap = {}; // 用于跟踪已添加的日期标签位置
                    
                    product.stages.forEach(stage => {
                        // 确保有开始和结束日期
                        if (stage.startDate && stage.endDate) {
                            const startPosition = calculateDatePosition(stage.startDate);
                            const endPosition = calculateDatePosition(stage.endDate);
                            const width = endPosition - startPosition;
                            
                            // 创建时间线段
                            const segment = document.createElement('div');
                            segment.className = `timeline-bar timeline-segment-${stage.name}`;
                            segment.style.left = `${startPosition}px`;
                            segment.style.width = `${width}px`;
                            timelineArea.appendChild(segment);
                            
                            // 只有在这个位置附近没有其他日期标签时才添加标签
                            const startDateKey = Math.floor(startPosition / 15);
                            if (!addedDatesMap[startDateKey]) {
                                // 添加起始日期标签
                                const startLabel = document.createElement('div');
                                startLabel.className = 'stage-date';
                                startLabel.textContent = formatDateDisplay(stage.startDate);
                                startLabel.style.left = `${startPosition}px`;
                                timelineArea.appendChild(startLabel);
                                
                                // 记录已添加的位置
                                addedDatesMap[startDateKey] = true;
                            }
                            
                            // 只在阶段较长且位置没有其他标签时添加结束日期标签
                            // 对于发布阶段，不在这里添加结束日期
                            if (stage.name !== 'release' && width > 80) {
                                const endDateKey = Math.floor(endPosition / 15);
                                if (!addedDatesMap[endDateKey]) {
                                    const endLabel = document.createElement('div');
                                    endLabel.className = 'stage-date';
                                    endLabel.textContent = formatDateDisplay(stage.endDate);
                                    endLabel.style.left = `${endPosition}px`;
                                    
                                    // 处理边缘情况
                                    if (endPosition >= timelineWidth - 50) {
                                        endLabel.classList.add('edge-right');
                                    }
                                    
                                    timelineArea.appendChild(endLabel);
                                    
                                    // 记录已添加位置
                                    addedDatesMap[endDateKey] = true;
                                }
                            }
                        }
                    });
                    
                    // 在ms-qa结束位置添加release标签
                    if (releaseStage && releaseStage.endDate) {
                        const releasePosition = calculateDatePosition(releaseStage.endDate);
                        
                        const releaseLabel = document.createElement('div');
                        releaseLabel.className = 'release-date';
                        releaseLabel.textContent = `Release: ${formatDateDisplay(releaseStage.endDate)}`;
                        releaseLabel.style.left = `${releasePosition}px`;
                        timelineArea.appendChild(releaseLabel);
                    }
                    
                    // 添加到行
                    row.appendChild(productCell);
                    row.appendChild(timelineCell);
                    
                    // 创建Key Features展开区域
                    const featuresRow = document.createElement('tr');
                    featuresRow.className = 'features-row';
                    featuresRow.style.display = 'none'; // 默认隐藏
                    
                    const featuresCell = document.createElement('td');
                    featuresCell.className = 'key-features-cell';
                    featuresCell.colSpan = 2;
                    featuresCell.innerHTML = `
                        <div id="features-${product.id}" class="key-features">
                            <h4 class="font-medium text-gray-800 mb-2">Key Features:</h4>
                            <ul class="features-list">
                                ${product.keyFeatures.map(feature => 
                                    `<li><i class="fas fa-check-circle"></i> ${feature}</li>`
                                ).join('')}
                            </ul>
                            ${product.delayFactors && product.delayFactors.length > 0 ? `
                                <h4 class="font-medium text-gray-800 mt-4 mb-2">Delay Factors:</h4>
                                <ul class="features-list">
                                    ${product.delayFactors.map(factor => 
                                        `<li><i class="fas fa-exclamation-circle text-yellow-500"></i> ${factor}</li>`
                                    ).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    `;
                    
                    featuresRow.appendChild(featuresCell);
                    
                    // 添加到容器
                    container.appendChild(row);
                    container.appendChild(featuresRow);
                });
                
                // 创建月份刻度和今天标记
                createMonthScale();
                
                // 窗口大小调整时重新计算布局
                window.addEventListener('resize', function() {
                    // 清除现有的月份标记和今天标记
                    document.getElementById('month-header').innerHTML = '';
                    
                    // 重新创建
                    createMonthScale();
                });
                
            } catch (error) {
                console.error('Error rendering timeline:', error);
                // 显示错误信息
                const errorElement = document.createElement('div');
                errorElement.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4';
                errorElement.textContent = 'Failed to load product data. Please try again later.';
                
                const container = document.querySelector('.container');
                container.insertBefore(errorElement, container.firstChild);
            }
        }
        
        // 切换显示特性
        function toggleFeatures(productId) {
            const productRow = document.querySelector(`tr[data-product-id="${productId}"]`);
            const featuresRow = productRow.nextElementSibling;
            const icon = document.getElementById(`icon-${productId}`);
            
            if (featuresRow.style.display === 'none') {
                // 打开Key Features
                featuresRow.style.display = 'table-row';
                // 激活Key Features样式
                document.getElementById(`features-${productId}`).classList.add('active');
                // 改变图标
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-down');
            } else {
                // 关闭Key Features
                featuresRow.style.display = 'none';
                // 取消激活Key Features样式
                document.getElementById(`features-${productId}`).classList.remove('active');
                // 改变图标
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-right');
            }
        }
        
        // 确保toggleFeatures在全局作用域可用
        window.toggleFeatures = toggleFeatures;
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', renderProductTimeline);
    </script>
</body>
</html> 